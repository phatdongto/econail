{"ast":null,"code":"var _class, _temp;\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n\n  _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nvar _require = require('@uppy/core'),\n    Plugin = _require.Plugin;\n\nvar Translator = require('@uppy/utils/lib/Translator');\n\nvar dataURItoBlob = require('@uppy/utils/lib/dataURItoBlob');\n\nvar isObjectURL = require('@uppy/utils/lib/isObjectURL');\n\nvar isPreviewSupported = require('@uppy/utils/lib/isPreviewSupported');\n\nvar MathLog2 = require('math-log2'); // Polyfill for IE.\n\n\nvar exifr = require('exifr/dist/mini.legacy.umd.js');\n/**\n * The Thumbnail Generator plugin\n */\n\n\nmodule.exports = (_temp = _class = /*#__PURE__*/function (_Plugin) {\n  _inheritsLoose(ThumbnailGenerator, _Plugin);\n\n  function ThumbnailGenerator(uppy, opts) {\n    var _this;\n\n    _this = _Plugin.call(this, uppy, opts) || this;\n\n    _this.onFileAdded = function (file) {\n      if (!file.preview && file.data && isPreviewSupported(file.type) && !file.isRemote) {\n        _this.addToQueue(file.id);\n      }\n    };\n\n    _this.onCancelRequest = function (file) {\n      var index = _this.queue.indexOf(file.id);\n\n      if (index !== -1) {\n        _this.queue.splice(index, 1);\n      }\n    };\n\n    _this.onFileRemoved = function (file) {\n      var index = _this.queue.indexOf(file.id);\n\n      if (index !== -1) {\n        _this.queue.splice(index, 1);\n      } // Clean up object URLs.\n\n\n      if (file.preview && isObjectURL(file.preview)) {\n        URL.revokeObjectURL(file.preview);\n      }\n    };\n\n    _this.onRestored = function () {\n      var restoredFiles = _this.uppy.getFiles().filter(function (file) {\n        return file.isRestored;\n      });\n\n      restoredFiles.forEach(function (file) {\n        // Only add blob URLs; they are likely invalid after being restored.\n        if (!file.preview || isObjectURL(file.preview)) {\n          _this.addToQueue(file.id);\n        }\n      });\n    };\n\n    _this.waitUntilAllProcessed = function (fileIDs) {\n      fileIDs.forEach(function (fileID) {\n        var file = _this.uppy.getFile(fileID);\n\n        _this.uppy.emit('preprocess-progress', file, {\n          mode: 'indeterminate',\n          message: _this.i18n('generatingThumbnails')\n        });\n      });\n\n      var emitPreprocessCompleteForAll = function emitPreprocessCompleteForAll() {\n        fileIDs.forEach(function (fileID) {\n          var file = _this.uppy.getFile(fileID);\n\n          _this.uppy.emit('preprocess-complete', file);\n        });\n      };\n\n      return new Promise(function (resolve, reject) {\n        if (_this.queueProcessing) {\n          _this.uppy.once('thumbnail:all-generated', function () {\n            emitPreprocessCompleteForAll();\n            resolve();\n          });\n        } else {\n          emitPreprocessCompleteForAll();\n          resolve();\n        }\n      });\n    };\n\n    _this.type = 'modifier';\n    _this.id = _this.opts.id || 'ThumbnailGenerator';\n    _this.title = 'Thumbnail Generator';\n    _this.queue = [];\n    _this.queueProcessing = false;\n    _this.defaultThumbnailDimension = 200;\n    _this.thumbnailType = _this.opts.thumbnailType || 'image/jpeg';\n    _this.defaultLocale = {\n      strings: {\n        generatingThumbnails: 'Generating thumbnails...'\n      }\n    };\n    var defaultOptions = {\n      thumbnailWidth: null,\n      thumbnailHeight: null,\n      waitForThumbnailsBeforeUpload: false,\n      lazy: false\n    };\n    _this.opts = _extends({}, defaultOptions, opts);\n\n    if (_this.opts.lazy && _this.opts.waitForThumbnailsBeforeUpload) {\n      throw new Error('ThumbnailGenerator: The `lazy` and `waitForThumbnailsBeforeUpload` options are mutually exclusive. Please ensure at most one of them is set to `true`.');\n    }\n\n    _this.i18nInit();\n\n    return _this;\n  }\n\n  var _proto = ThumbnailGenerator.prototype;\n\n  _proto.setOptions = function setOptions(newOpts) {\n    _Plugin.prototype.setOptions.call(this, newOpts);\n\n    this.i18nInit();\n  };\n\n  _proto.i18nInit = function i18nInit() {\n    this.translator = new Translator([this.defaultLocale, this.uppy.locale, this.opts.locale]);\n    this.i18n = this.translator.translate.bind(this.translator);\n    this.setPluginState(); // so that UI re-renders and we see the updated locale\n  }\n  /**\n   * Create a thumbnail for the given Uppy file object.\n   *\n   * @param {{data: Blob}} file\n   * @param {number} targetWidth\n   * @param {number} targetHeight\n   * @returns {Promise}\n   */\n  ;\n\n  _proto.createThumbnail = function createThumbnail(file, targetWidth, targetHeight) {\n    var _this2 = this; // bug in the compatibility data\n    // eslint-disable-next-line compat/compat\n\n\n    var originalUrl = URL.createObjectURL(file.data);\n    var onload = new Promise(function (resolve, reject) {\n      var image = new Image();\n      image.src = originalUrl;\n      image.addEventListener('load', function () {\n        // bug in the compatibility data\n        // eslint-disable-next-line compat/compat\n        URL.revokeObjectURL(originalUrl);\n        resolve(image);\n      });\n      image.addEventListener('error', function (event) {\n        // bug in the compatibility data\n        // eslint-disable-next-line compat/compat\n        URL.revokeObjectURL(originalUrl);\n        reject(event.error || new Error('Could not create thumbnail'));\n      });\n    });\n    var orientationPromise = exifr.rotation(file.data).catch(function (_err) {\n      return 1;\n    });\n    return Promise.all([onload, orientationPromise]).then(function (_ref) {\n      var image = _ref[0],\n          orientation = _ref[1];\n\n      var dimensions = _this2.getProportionalDimensions(image, targetWidth, targetHeight, orientation.deg);\n\n      var rotatedImage = _this2.rotateImage(image, orientation);\n\n      var resizedImage = _this2.resizeImage(rotatedImage, dimensions.width, dimensions.height);\n\n      return _this2.canvasToBlob(resizedImage, _this2.thumbnailType, 80);\n    }).then(function (blob) {\n      // bug in the compatibility data\n      // eslint-disable-next-line compat/compat\n      return URL.createObjectURL(blob);\n    });\n  }\n  /**\n   * Get the new calculated dimensions for the given image and a target width\n   * or height. If both width and height are given, only width is taken into\n   * account. If neither width nor height are given, the default dimension\n   * is used.\n   */\n  ;\n\n  _proto.getProportionalDimensions = function getProportionalDimensions(img, width, height, rotation) {\n    var aspect = img.width / img.height;\n\n    if (rotation === 90 || rotation === 270) {\n      aspect = img.height / img.width;\n    }\n\n    if (width != null) {\n      return {\n        width: width,\n        height: Math.round(width / aspect)\n      };\n    }\n\n    if (height != null) {\n      return {\n        width: Math.round(height * aspect),\n        height: height\n      };\n    }\n\n    return {\n      width: this.defaultThumbnailDimension,\n      height: Math.round(this.defaultThumbnailDimension / aspect)\n    };\n  }\n  /**\n   * Make sure the image doesn’t exceed browser/device canvas limits.\n   * For ios with 256 RAM and ie\n   */\n  ;\n\n  _proto.protect = function protect(image) {\n    // https://stackoverflow.com/questions/6081483/maximum-size-of-a-canvas-element\n    var ratio = image.width / image.height;\n    var maxSquare = 5000000; // ios max canvas square\n\n    var maxSize = 4096; // ie max canvas dimensions\n\n    var maxW = Math.floor(Math.sqrt(maxSquare * ratio));\n    var maxH = Math.floor(maxSquare / Math.sqrt(maxSquare * ratio));\n\n    if (maxW > maxSize) {\n      maxW = maxSize;\n      maxH = Math.round(maxW / ratio);\n    }\n\n    if (maxH > maxSize) {\n      maxH = maxSize;\n      maxW = Math.round(ratio * maxH);\n    }\n\n    if (image.width > maxW) {\n      var canvas = document.createElement('canvas');\n      canvas.width = maxW;\n      canvas.height = maxH;\n      canvas.getContext('2d').drawImage(image, 0, 0, maxW, maxH);\n      image = canvas;\n    }\n\n    return image;\n  }\n  /**\n   * Resize an image to the target `width` and `height`.\n   *\n   * Returns a Canvas with the resized image on it.\n   */\n  ;\n\n  _proto.resizeImage = function resizeImage(image, targetWidth, targetHeight) {\n    // Resizing in steps refactored to use a solution from\n    // https://blog.uploadcare.com/image-resize-in-browsers-is-broken-e38eed08df01\n    image = this.protect(image);\n    var steps = Math.ceil(MathLog2(image.width / targetWidth));\n\n    if (steps < 1) {\n      steps = 1;\n    }\n\n    var sW = targetWidth * Math.pow(2, steps - 1);\n    var sH = targetHeight * Math.pow(2, steps - 1);\n    var x = 2;\n\n    while (steps--) {\n      var canvas = document.createElement('canvas');\n      canvas.width = sW;\n      canvas.height = sH;\n      canvas.getContext('2d').drawImage(image, 0, 0, sW, sH);\n      image = canvas;\n      sW = Math.round(sW / x);\n      sH = Math.round(sH / x);\n    }\n\n    return image;\n  };\n\n  _proto.rotateImage = function rotateImage(image, translate) {\n    var w = image.width;\n    var h = image.height;\n\n    if (translate.deg === 90 || translate.deg === 270) {\n      w = image.height;\n      h = image.width;\n    }\n\n    var canvas = document.createElement('canvas');\n    canvas.width = w;\n    canvas.height = h;\n    var context = canvas.getContext('2d');\n    context.translate(w / 2, h / 2);\n\n    if (translate.canvas) {\n      context.rotate(translate.rad);\n      context.scale(translate.scaleX, translate.scaleY);\n    }\n\n    context.drawImage(image, -image.width / 2, -image.height / 2, image.width, image.height);\n    return canvas;\n  }\n  /**\n   * Save a <canvas> element's content to a Blob object.\n   *\n   * @param {HTMLCanvasElement} canvas\n   * @returns {Promise}\n   */\n  ;\n\n  _proto.canvasToBlob = function canvasToBlob(canvas, type, quality) {\n    try {\n      canvas.getContext('2d').getImageData(0, 0, 1, 1);\n    } catch (err) {\n      if (err.code === 18) {\n        return Promise.reject(new Error('cannot read image, probably an svg with external resources'));\n      }\n    }\n\n    if (canvas.toBlob) {\n      return new Promise(function (resolve) {\n        canvas.toBlob(resolve, type, quality);\n      }).then(function (blob) {\n        if (blob === null) {\n          throw new Error('cannot read image, probably an svg with external resources');\n        }\n\n        return blob;\n      });\n    }\n\n    return Promise.resolve().then(function () {\n      return dataURItoBlob(canvas.toDataURL(type, quality), {});\n    }).then(function (blob) {\n      if (blob === null) {\n        throw new Error('could not extract blob, probably an old browser');\n      }\n\n      return blob;\n    });\n  }\n  /**\n   * Set the preview URL for a file.\n   */\n  ;\n\n  _proto.setPreviewURL = function setPreviewURL(fileID, preview) {\n    this.uppy.setFileState(fileID, {\n      preview: preview\n    });\n  };\n\n  _proto.addToQueue = function addToQueue(item) {\n    this.queue.push(item);\n\n    if (this.queueProcessing === false) {\n      this.processQueue();\n    }\n  };\n\n  _proto.processQueue = function processQueue() {\n    var _this3 = this;\n\n    this.queueProcessing = true;\n\n    if (this.queue.length > 0) {\n      var current = this.uppy.getFile(this.queue.shift());\n\n      if (!current) {\n        this.uppy.log('[ThumbnailGenerator] file was removed before a thumbnail could be generated, but not removed from the queue. This is probably a bug', 'error');\n        return;\n      }\n\n      return this.requestThumbnail(current).catch(function (err) {}) // eslint-disable-line handle-callback-err\n      .then(function () {\n        return _this3.processQueue();\n      });\n    }\n\n    this.queueProcessing = false;\n    this.uppy.log('[ThumbnailGenerator] Emptied thumbnail queue');\n    this.uppy.emit('thumbnail:all-generated');\n  };\n\n  _proto.requestThumbnail = function requestThumbnail(file) {\n    var _this4 = this;\n\n    if (isPreviewSupported(file.type) && !file.isRemote) {\n      return this.createThumbnail(file, this.opts.thumbnailWidth, this.opts.thumbnailHeight).then(function (preview) {\n        _this4.setPreviewURL(file.id, preview);\n\n        _this4.uppy.log(\"[ThumbnailGenerator] Generated thumbnail for \" + file.id);\n\n        _this4.uppy.emit('thumbnail:generated', _this4.uppy.getFile(file.id), preview);\n      }).catch(function (err) {\n        _this4.uppy.log(\"[ThumbnailGenerator] Failed thumbnail for \" + file.id + \":\", 'warning');\n\n        _this4.uppy.log(err, 'warning');\n\n        _this4.uppy.emit('thumbnail:error', _this4.uppy.getFile(file.id), err);\n      });\n    }\n\n    return Promise.resolve();\n  };\n\n  _proto.install = function install() {\n    this.uppy.on('file-removed', this.onFileRemoved);\n\n    if (this.opts.lazy) {\n      this.uppy.on('thumbnail:request', this.onFileAdded);\n      this.uppy.on('thumbnail:cancel', this.onCancelRequest);\n    } else {\n      this.uppy.on('file-added', this.onFileAdded);\n      this.uppy.on('restored', this.onRestored);\n    }\n\n    if (this.opts.waitForThumbnailsBeforeUpload) {\n      this.uppy.addPreProcessor(this.waitUntilAllProcessed);\n    }\n  };\n\n  _proto.uninstall = function uninstall() {\n    this.uppy.off('file-removed', this.onFileRemoved);\n\n    if (this.opts.lazy) {\n      this.uppy.off('thumbnail:request', this.onFileAdded);\n      this.uppy.off('thumbnail:cancel', this.onCancelRequest);\n    } else {\n      this.uppy.off('file-added', this.onFileAdded);\n      this.uppy.off('restored', this.onRestored);\n    }\n\n    if (this.opts.waitForThumbnailsBeforeUpload) {\n      this.uppy.removePreProcessor(this.waitUntilAllProcessed);\n    }\n  };\n\n  return ThumbnailGenerator;\n}(Plugin), _class.VERSION = \"1.7.10\", _temp);","map":{"version":3,"sources":["D:/Team6-FE/isomorphic/node_modules/@uppy/thumbnail-generator/lib/index.js"],"names":["_class","_temp","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","_inheritsLoose","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_require","require","Plugin","Translator","dataURItoBlob","isObjectURL","isPreviewSupported","MathLog2","exifr","module","exports","_Plugin","ThumbnailGenerator","uppy","opts","_this","onFileAdded","file","preview","data","type","isRemote","addToQueue","id","onCancelRequest","index","queue","indexOf","splice","onFileRemoved","URL","revokeObjectURL","onRestored","restoredFiles","getFiles","filter","isRestored","forEach","waitUntilAllProcessed","fileIDs","fileID","getFile","emit","mode","message","i18n","emitPreprocessCompleteForAll","Promise","resolve","reject","queueProcessing","once","title","defaultThumbnailDimension","thumbnailType","defaultLocale","strings","generatingThumbnails","defaultOptions","thumbnailWidth","thumbnailHeight","waitForThumbnailsBeforeUpload","lazy","Error","i18nInit","_proto","setOptions","newOpts","translator","locale","translate","bind","setPluginState","createThumbnail","targetWidth","targetHeight","_this2","originalUrl","createObjectURL","onload","image","Image","src","addEventListener","event","error","orientationPromise","rotation","catch","_err","all","then","_ref","orientation","dimensions","getProportionalDimensions","deg","rotatedImage","rotateImage","resizedImage","resizeImage","width","height","canvasToBlob","blob","img","aspect","Math","round","protect","ratio","maxSquare","maxSize","maxW","floor","sqrt","maxH","canvas","document","createElement","getContext","drawImage","steps","ceil","sW","pow","sH","x","w","h","context","rotate","rad","scale","scaleX","scaleY","quality","getImageData","err","code","toBlob","toDataURL","setPreviewURL","setFileState","item","push","processQueue","_this3","current","shift","log","requestThumbnail","_this4","install","on","addPreProcessor","uninstall","off","removePreProcessor","VERSION"],"mappings":"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","sourcesContent":["var _class, _temp;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nvar _require = require('@uppy/core'),\n    Plugin = _require.Plugin;\n\nvar Translator = require('@uppy/utils/lib/Translator');\n\nvar dataURItoBlob = require('@uppy/utils/lib/dataURItoBlob');\n\nvar isObjectURL = require('@uppy/utils/lib/isObjectURL');\n\nvar isPreviewSupported = require('@uppy/utils/lib/isPreviewSupported');\n\nvar MathLog2 = require('math-log2'); // Polyfill for IE.\n\n\nvar exifr = require('exifr/dist/mini.legacy.umd.js');\n/**\n * The Thumbnail Generator plugin\n */\n\n\nmodule.exports = (_temp = _class = /*#__PURE__*/function (_Plugin) {\n  _inheritsLoose(ThumbnailGenerator, _Plugin);\n\n  function ThumbnailGenerator(uppy, opts) {\n    var _this;\n\n    _this = _Plugin.call(this, uppy, opts) || this;\n\n    _this.onFileAdded = function (file) {\n      if (!file.preview && file.data && isPreviewSupported(file.type) && !file.isRemote) {\n        _this.addToQueue(file.id);\n      }\n    };\n\n    _this.onCancelRequest = function (file) {\n      var index = _this.queue.indexOf(file.id);\n\n      if (index !== -1) {\n        _this.queue.splice(index, 1);\n      }\n    };\n\n    _this.onFileRemoved = function (file) {\n      var index = _this.queue.indexOf(file.id);\n\n      if (index !== -1) {\n        _this.queue.splice(index, 1);\n      } // Clean up object URLs.\n\n\n      if (file.preview && isObjectURL(file.preview)) {\n        URL.revokeObjectURL(file.preview);\n      }\n    };\n\n    _this.onRestored = function () {\n      var restoredFiles = _this.uppy.getFiles().filter(function (file) {\n        return file.isRestored;\n      });\n\n      restoredFiles.forEach(function (file) {\n        // Only add blob URLs; they are likely invalid after being restored.\n        if (!file.preview || isObjectURL(file.preview)) {\n          _this.addToQueue(file.id);\n        }\n      });\n    };\n\n    _this.waitUntilAllProcessed = function (fileIDs) {\n      fileIDs.forEach(function (fileID) {\n        var file = _this.uppy.getFile(fileID);\n\n        _this.uppy.emit('preprocess-progress', file, {\n          mode: 'indeterminate',\n          message: _this.i18n('generatingThumbnails')\n        });\n      });\n\n      var emitPreprocessCompleteForAll = function emitPreprocessCompleteForAll() {\n        fileIDs.forEach(function (fileID) {\n          var file = _this.uppy.getFile(fileID);\n\n          _this.uppy.emit('preprocess-complete', file);\n        });\n      };\n\n      return new Promise(function (resolve, reject) {\n        if (_this.queueProcessing) {\n          _this.uppy.once('thumbnail:all-generated', function () {\n            emitPreprocessCompleteForAll();\n            resolve();\n          });\n        } else {\n          emitPreprocessCompleteForAll();\n          resolve();\n        }\n      });\n    };\n\n    _this.type = 'modifier';\n    _this.id = _this.opts.id || 'ThumbnailGenerator';\n    _this.title = 'Thumbnail Generator';\n    _this.queue = [];\n    _this.queueProcessing = false;\n    _this.defaultThumbnailDimension = 200;\n    _this.thumbnailType = _this.opts.thumbnailType || 'image/jpeg';\n    _this.defaultLocale = {\n      strings: {\n        generatingThumbnails: 'Generating thumbnails...'\n      }\n    };\n    var defaultOptions = {\n      thumbnailWidth: null,\n      thumbnailHeight: null,\n      waitForThumbnailsBeforeUpload: false,\n      lazy: false\n    };\n    _this.opts = _extends({}, defaultOptions, opts);\n\n    if (_this.opts.lazy && _this.opts.waitForThumbnailsBeforeUpload) {\n      throw new Error('ThumbnailGenerator: The `lazy` and `waitForThumbnailsBeforeUpload` options are mutually exclusive. Please ensure at most one of them is set to `true`.');\n    }\n\n    _this.i18nInit();\n\n    return _this;\n  }\n\n  var _proto = ThumbnailGenerator.prototype;\n\n  _proto.setOptions = function setOptions(newOpts) {\n    _Plugin.prototype.setOptions.call(this, newOpts);\n\n    this.i18nInit();\n  };\n\n  _proto.i18nInit = function i18nInit() {\n    this.translator = new Translator([this.defaultLocale, this.uppy.locale, this.opts.locale]);\n    this.i18n = this.translator.translate.bind(this.translator);\n    this.setPluginState(); // so that UI re-renders and we see the updated locale\n  }\n  /**\n   * Create a thumbnail for the given Uppy file object.\n   *\n   * @param {{data: Blob}} file\n   * @param {number} targetWidth\n   * @param {number} targetHeight\n   * @returns {Promise}\n   */\n  ;\n\n  _proto.createThumbnail = function createThumbnail(file, targetWidth, targetHeight) {\n    var _this2 = this;\n\n    // bug in the compatibility data\n    // eslint-disable-next-line compat/compat\n    var originalUrl = URL.createObjectURL(file.data);\n    var onload = new Promise(function (resolve, reject) {\n      var image = new Image();\n      image.src = originalUrl;\n      image.addEventListener('load', function () {\n        // bug in the compatibility data\n        // eslint-disable-next-line compat/compat\n        URL.revokeObjectURL(originalUrl);\n        resolve(image);\n      });\n      image.addEventListener('error', function (event) {\n        // bug in the compatibility data\n        // eslint-disable-next-line compat/compat\n        URL.revokeObjectURL(originalUrl);\n        reject(event.error || new Error('Could not create thumbnail'));\n      });\n    });\n    var orientationPromise = exifr.rotation(file.data).catch(function (_err) {\n      return 1;\n    });\n    return Promise.all([onload, orientationPromise]).then(function (_ref) {\n      var image = _ref[0],\n          orientation = _ref[1];\n\n      var dimensions = _this2.getProportionalDimensions(image, targetWidth, targetHeight, orientation.deg);\n\n      var rotatedImage = _this2.rotateImage(image, orientation);\n\n      var resizedImage = _this2.resizeImage(rotatedImage, dimensions.width, dimensions.height);\n\n      return _this2.canvasToBlob(resizedImage, _this2.thumbnailType, 80);\n    }).then(function (blob) {\n      // bug in the compatibility data\n      // eslint-disable-next-line compat/compat\n      return URL.createObjectURL(blob);\n    });\n  }\n  /**\n   * Get the new calculated dimensions for the given image and a target width\n   * or height. If both width and height are given, only width is taken into\n   * account. If neither width nor height are given, the default dimension\n   * is used.\n   */\n  ;\n\n  _proto.getProportionalDimensions = function getProportionalDimensions(img, width, height, rotation) {\n    var aspect = img.width / img.height;\n\n    if (rotation === 90 || rotation === 270) {\n      aspect = img.height / img.width;\n    }\n\n    if (width != null) {\n      return {\n        width: width,\n        height: Math.round(width / aspect)\n      };\n    }\n\n    if (height != null) {\n      return {\n        width: Math.round(height * aspect),\n        height: height\n      };\n    }\n\n    return {\n      width: this.defaultThumbnailDimension,\n      height: Math.round(this.defaultThumbnailDimension / aspect)\n    };\n  }\n  /**\n   * Make sure the image doesn’t exceed browser/device canvas limits.\n   * For ios with 256 RAM and ie\n   */\n  ;\n\n  _proto.protect = function protect(image) {\n    // https://stackoverflow.com/questions/6081483/maximum-size-of-a-canvas-element\n    var ratio = image.width / image.height;\n    var maxSquare = 5000000; // ios max canvas square\n\n    var maxSize = 4096; // ie max canvas dimensions\n\n    var maxW = Math.floor(Math.sqrt(maxSquare * ratio));\n    var maxH = Math.floor(maxSquare / Math.sqrt(maxSquare * ratio));\n\n    if (maxW > maxSize) {\n      maxW = maxSize;\n      maxH = Math.round(maxW / ratio);\n    }\n\n    if (maxH > maxSize) {\n      maxH = maxSize;\n      maxW = Math.round(ratio * maxH);\n    }\n\n    if (image.width > maxW) {\n      var canvas = document.createElement('canvas');\n      canvas.width = maxW;\n      canvas.height = maxH;\n      canvas.getContext('2d').drawImage(image, 0, 0, maxW, maxH);\n      image = canvas;\n    }\n\n    return image;\n  }\n  /**\n   * Resize an image to the target `width` and `height`.\n   *\n   * Returns a Canvas with the resized image on it.\n   */\n  ;\n\n  _proto.resizeImage = function resizeImage(image, targetWidth, targetHeight) {\n    // Resizing in steps refactored to use a solution from\n    // https://blog.uploadcare.com/image-resize-in-browsers-is-broken-e38eed08df01\n    image = this.protect(image);\n    var steps = Math.ceil(MathLog2(image.width / targetWidth));\n\n    if (steps < 1) {\n      steps = 1;\n    }\n\n    var sW = targetWidth * Math.pow(2, steps - 1);\n    var sH = targetHeight * Math.pow(2, steps - 1);\n    var x = 2;\n\n    while (steps--) {\n      var canvas = document.createElement('canvas');\n      canvas.width = sW;\n      canvas.height = sH;\n      canvas.getContext('2d').drawImage(image, 0, 0, sW, sH);\n      image = canvas;\n      sW = Math.round(sW / x);\n      sH = Math.round(sH / x);\n    }\n\n    return image;\n  };\n\n  _proto.rotateImage = function rotateImage(image, translate) {\n    var w = image.width;\n    var h = image.height;\n\n    if (translate.deg === 90 || translate.deg === 270) {\n      w = image.height;\n      h = image.width;\n    }\n\n    var canvas = document.createElement('canvas');\n    canvas.width = w;\n    canvas.height = h;\n    var context = canvas.getContext('2d');\n    context.translate(w / 2, h / 2);\n\n    if (translate.canvas) {\n      context.rotate(translate.rad);\n      context.scale(translate.scaleX, translate.scaleY);\n    }\n\n    context.drawImage(image, -image.width / 2, -image.height / 2, image.width, image.height);\n    return canvas;\n  }\n  /**\n   * Save a <canvas> element's content to a Blob object.\n   *\n   * @param {HTMLCanvasElement} canvas\n   * @returns {Promise}\n   */\n  ;\n\n  _proto.canvasToBlob = function canvasToBlob(canvas, type, quality) {\n    try {\n      canvas.getContext('2d').getImageData(0, 0, 1, 1);\n    } catch (err) {\n      if (err.code === 18) {\n        return Promise.reject(new Error('cannot read image, probably an svg with external resources'));\n      }\n    }\n\n    if (canvas.toBlob) {\n      return new Promise(function (resolve) {\n        canvas.toBlob(resolve, type, quality);\n      }).then(function (blob) {\n        if (blob === null) {\n          throw new Error('cannot read image, probably an svg with external resources');\n        }\n\n        return blob;\n      });\n    }\n\n    return Promise.resolve().then(function () {\n      return dataURItoBlob(canvas.toDataURL(type, quality), {});\n    }).then(function (blob) {\n      if (blob === null) {\n        throw new Error('could not extract blob, probably an old browser');\n      }\n\n      return blob;\n    });\n  }\n  /**\n   * Set the preview URL for a file.\n   */\n  ;\n\n  _proto.setPreviewURL = function setPreviewURL(fileID, preview) {\n    this.uppy.setFileState(fileID, {\n      preview: preview\n    });\n  };\n\n  _proto.addToQueue = function addToQueue(item) {\n    this.queue.push(item);\n\n    if (this.queueProcessing === false) {\n      this.processQueue();\n    }\n  };\n\n  _proto.processQueue = function processQueue() {\n    var _this3 = this;\n\n    this.queueProcessing = true;\n\n    if (this.queue.length > 0) {\n      var current = this.uppy.getFile(this.queue.shift());\n\n      if (!current) {\n        this.uppy.log('[ThumbnailGenerator] file was removed before a thumbnail could be generated, but not removed from the queue. This is probably a bug', 'error');\n        return;\n      }\n\n      return this.requestThumbnail(current).catch(function (err) {}) // eslint-disable-line handle-callback-err\n      .then(function () {\n        return _this3.processQueue();\n      });\n    }\n\n    this.queueProcessing = false;\n    this.uppy.log('[ThumbnailGenerator] Emptied thumbnail queue');\n    this.uppy.emit('thumbnail:all-generated');\n  };\n\n  _proto.requestThumbnail = function requestThumbnail(file) {\n    var _this4 = this;\n\n    if (isPreviewSupported(file.type) && !file.isRemote) {\n      return this.createThumbnail(file, this.opts.thumbnailWidth, this.opts.thumbnailHeight).then(function (preview) {\n        _this4.setPreviewURL(file.id, preview);\n\n        _this4.uppy.log(\"[ThumbnailGenerator] Generated thumbnail for \" + file.id);\n\n        _this4.uppy.emit('thumbnail:generated', _this4.uppy.getFile(file.id), preview);\n      }).catch(function (err) {\n        _this4.uppy.log(\"[ThumbnailGenerator] Failed thumbnail for \" + file.id + \":\", 'warning');\n\n        _this4.uppy.log(err, 'warning');\n\n        _this4.uppy.emit('thumbnail:error', _this4.uppy.getFile(file.id), err);\n      });\n    }\n\n    return Promise.resolve();\n  };\n\n  _proto.install = function install() {\n    this.uppy.on('file-removed', this.onFileRemoved);\n\n    if (this.opts.lazy) {\n      this.uppy.on('thumbnail:request', this.onFileAdded);\n      this.uppy.on('thumbnail:cancel', this.onCancelRequest);\n    } else {\n      this.uppy.on('file-added', this.onFileAdded);\n      this.uppy.on('restored', this.onRestored);\n    }\n\n    if (this.opts.waitForThumbnailsBeforeUpload) {\n      this.uppy.addPreProcessor(this.waitUntilAllProcessed);\n    }\n  };\n\n  _proto.uninstall = function uninstall() {\n    this.uppy.off('file-removed', this.onFileRemoved);\n\n    if (this.opts.lazy) {\n      this.uppy.off('thumbnail:request', this.onFileAdded);\n      this.uppy.off('thumbnail:cancel', this.onCancelRequest);\n    } else {\n      this.uppy.off('file-added', this.onFileAdded);\n      this.uppy.off('restored', this.onRestored);\n    }\n\n    if (this.opts.waitForThumbnailsBeforeUpload) {\n      this.uppy.removePreProcessor(this.waitUntilAllProcessed);\n    }\n  };\n\n  return ThumbnailGenerator;\n}(Plugin), _class.VERSION = \"1.7.10\", _temp);"]},"metadata":{},"sourceType":"script"}