{"ast":null,"code":"import { all, takeEvery, put, call } from 'redux-saga/effects';\nimport actions from './actions';\nimport omit from 'lodash/omit';\nimport fakeData from './fakeData';\nimport { rsf, db } from '@iso/lib/firebase/firebase';\nimport { convertCollectionsSnapshotToMap, deleteDocuments, addCollectionAndDocuments } from '@iso/lib/firebase/firebase.util';\nconst fakeDataList = new fakeData(5).getAll();\n/**\r\n * DOC: https://redux-saga-firebase.js.org/reference/dev/firestore\r\n */\n\nconst COLLECTION_NAME = 'articles'; // change your collection\n\nconst ORDER_BY = 'id';\nconst ORDER = 'desc';\n\nfunction* loadFromFirestore() {\n  try {\n    const collectionRef = db.collection(COLLECTION_NAME).where('deleted_at', '==', null).orderBy(ORDER_BY, ORDER);\n    const snapshots = yield call(rsf.firestore.getCollection, collectionRef);\n    let data = yield call(convertCollectionsSnapshotToMap, snapshots);\n    yield put(actions.loadFromFireStoreSuccess(data));\n  } catch (error) {\n    console.log(error);\n    yield put(actions.loadFromFireStoreError(error));\n  }\n}\n\nfunction* storeIntoFirestore({\n  payload\n}) {\n  const {\n    data,\n    actionName\n  } = payload;\n\n  try {\n    switch (actionName) {\n      case 'delete':\n        yield call(rsf.firestore.setDocument, `${COLLECTION_NAME}/${data.key}`, {\n          deleted_at: new Date().getTime()\n        });\n        break;\n\n      case 'update':\n        yield call(rsf.firestore.setDocument, `${COLLECTION_NAME}/${data.key}`, { ...omit(data, ['key'])\n        });\n        break;\n\n      default:\n        yield call(rsf.firestore.addDocument, COLLECTION_NAME, data);\n        break;\n    }\n\n    yield put({\n      type: actions.LOAD_FROM_FIRESTORE\n    });\n  } catch (error) {\n    console.log(error);\n    yield put(actions.saveIntoFireStoreError(error));\n  }\n}\n\nfunction* resetFireStoreDocuments() {\n  try {\n    yield call(deleteDocuments, COLLECTION_NAME);\n    yield call(addCollectionAndDocuments, COLLECTION_NAME, fakeDataList);\n    yield put({\n      type: actions.LOAD_FROM_FIRESTORE\n    });\n  } catch (error) {\n    console.log(error);\n  }\n}\n\nexport default function* rootSaga() {\n  yield all([takeEvery(actions.LOAD_FROM_FIRESTORE, loadFromFirestore), takeEvery(actions.SAVE_INTO_FIRESTORE, storeIntoFirestore), takeEvery(actions.RESET_FIRESTORE_DOCUMENTS, resetFireStoreDocuments)]);\n}","map":{"version":3,"sources":["D:/TT18-EC-Team1-FE/isomorphic/shared/isomorphic/redux/articles/sagas.js"],"names":["all","takeEvery","put","call","actions","omit","fakeData","rsf","db","convertCollectionsSnapshotToMap","deleteDocuments","addCollectionAndDocuments","fakeDataList","getAll","COLLECTION_NAME","ORDER_BY","ORDER","loadFromFirestore","collectionRef","collection","where","orderBy","snapshots","firestore","getCollection","data","loadFromFireStoreSuccess","error","console","log","loadFromFireStoreError","storeIntoFirestore","payload","actionName","setDocument","key","deleted_at","Date","getTime","addDocument","type","LOAD_FROM_FIRESTORE","saveIntoFireStoreError","resetFireStoreDocuments","rootSaga","SAVE_INTO_FIRESTORE","RESET_FIRESTORE_DOCUMENTS"],"mappings":"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","sourcesContent":["import { all, takeEvery, put, call } from 'redux-saga/effects';\r\nimport actions from './actions';\r\nimport omit from 'lodash/omit';\r\nimport fakeData from './fakeData';\r\nimport { rsf, db } from '@iso/lib/firebase/firebase';\r\nimport {\r\n  convertCollectionsSnapshotToMap,\r\n  deleteDocuments,\r\n  addCollectionAndDocuments,\r\n} from '@iso/lib/firebase/firebase.util';\r\n\r\nconst fakeDataList = new fakeData(5).getAll();\r\n\r\n/**\r\n * DOC: https://redux-saga-firebase.js.org/reference/dev/firestore\r\n */\r\n\r\nconst COLLECTION_NAME = 'articles'; // change your collection\r\nconst ORDER_BY = 'id';\r\nconst ORDER = 'desc';\r\n\r\nfunction* loadFromFirestore() {\r\n  try {\r\n    const collectionRef = db\r\n      .collection(COLLECTION_NAME)\r\n      .where('deleted_at', '==', null)\r\n      .orderBy(ORDER_BY, ORDER);\r\n\r\n    const snapshots = yield call(rsf.firestore.getCollection, collectionRef);\r\n    let data = yield call(convertCollectionsSnapshotToMap, snapshots);\r\n    yield put(actions.loadFromFireStoreSuccess(data));\r\n  } catch (error) {\r\n    console.log(error);\r\n    yield put(actions.loadFromFireStoreError(error));\r\n  }\r\n}\r\n\r\nfunction* storeIntoFirestore({ payload }) {\r\n  const { data, actionName } = payload;\r\n  try {\r\n    switch (actionName) {\r\n      case 'delete':\r\n        yield call(\r\n          rsf.firestore.setDocument,\r\n          `${COLLECTION_NAME}/${data.key}`,\r\n          {\r\n            deleted_at: new Date().getTime(),\r\n          }\r\n        );\r\n        break;\r\n      case 'update':\r\n        yield call(\r\n          rsf.firestore.setDocument,\r\n          `${COLLECTION_NAME}/${data.key}`,\r\n          {\r\n            ...omit(data, ['key']),\r\n          }\r\n        );\r\n        break;\r\n      default:\r\n        yield call(rsf.firestore.addDocument, COLLECTION_NAME, data);\r\n        break;\r\n    }\r\n    yield put({ type: actions.LOAD_FROM_FIRESTORE });\r\n  } catch (error) {\r\n    console.log(error);\r\n    yield put(actions.saveIntoFireStoreError(error));\r\n  }\r\n}\r\n\r\nfunction* resetFireStoreDocuments() {\r\n  try {\r\n    yield call(deleteDocuments, COLLECTION_NAME);\r\n    yield call(addCollectionAndDocuments, COLLECTION_NAME, fakeDataList);\r\n    yield put({ type: actions.LOAD_FROM_FIRESTORE });\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n}\r\n\r\nexport default function* rootSaga() {\r\n  yield all([\r\n    takeEvery(actions.LOAD_FROM_FIRESTORE, loadFromFirestore),\r\n    takeEvery(actions.SAVE_INTO_FIRESTORE, storeIntoFirestore),\r\n    takeEvery(actions.RESET_FIRESTORE_DOCUMENTS, resetFireStoreDocuments),\r\n  ]);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}